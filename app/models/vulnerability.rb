class Vulnerability < ActiveRecord::Base
  belongs_to :host, :counter_cache => true
  belongs_to :plugin, :counter_cache => true
  belongs_to :status

  def visible?
    if read_attribute(:visible).nil?
      plugin.visible?
    else
      read_attribute(:visible)
    end
  end
  
  def service
    if port == 0
      read_attribute(:service)
    else
      "#{read_attribute(:service)} (#{protocol}/#{port})"
    end
  end

  mirror :severity do
    plugin.severity(host.location)
  end
  
  mirror :description do
    plugin.description
  end
  
  mirror :evaluation do
    plugin.evaluation
  end

  mirror :remediation do
    plugin.remediation
  end
end
