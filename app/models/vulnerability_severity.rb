class VulnerabilitySeverity < ActiveRecord::Base
  belongs_to :severity
  has_many :vulnerabilities, :finder_sql => 'SELECT vulnerabilities.* FROM vulnerabilities ' +
                                            'LEFT JOIN plugins ON vulnerabilities.plugin_id = plugins.id ' +
                                            'LEFT JOIN hosts ON vulnerabilities.host_id = hosts.id ' +
                                            'WHERE hosts.location_id = #{location_id} AND ' +
                                            '      plugins.classification_id = #{classification_id}'
  
  def self.severify(classification, location)
    classification_id = nil
    location_id       = nil
    
    case classification
    when Fixnum
      classification_id = classification
    when Classification
      classification_id = classification.id
    else
      fail "classification must be an id of Family"
    end
    
    case location
    when Fixnum
      location_id = location
    when Location
      location_id = location.id
    else
      fail "location must be an id of Family"
    end
    
    VulnerabilitySeverity.find(:first, :conditions => { :classification_id => classification_id, :location_id => location_id }).severity rescue nil
  end
end
