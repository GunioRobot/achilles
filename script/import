#!/usr/bin/env ruby

require File.join(File.dirname(__FILE__), '..', 'config', 'environment')

if ARGV.size < 2
  puts "Usage: ./import [scan name] [file/dir 1] [file/dir 2] ... [file/dir n]"
else
  scan = Scan.find_or_create_by_name(ARGV.shift)
  
  scan.starts_at  = Time.now
  scan.save!

  scan.start!
  
  files = []
  
  ARGV.each do |arg|
    files << arg if File.file?(arg)
    files << Dir.glob(File.join(arg, '*')) if File.directory?(arg)
  end
  
  files.flatten.each do |file|
    Nessus.process(scan, file)
  end
  
  scan.stop!
end